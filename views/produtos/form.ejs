<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<div class="container mt-4">
  <h1><%= produto && produto.id ? 'Editar' : 'Novo' %> Produto</h1>
  <% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
    <div class="alert alert-danger"><strong>Erro:</strong> <%= errorMessage %></div>
  <% } %>
  <form action="<%= produto && produto.id ? '/produtos/' + produto.id + '?_method=PUT' : '/produtos' %>" method="POST" enctype="multipart/form-data">
    <div class="mb-3">
      <label class="form-label">Nome</label>
      <input type="text" name="nome" class="form-control" required value="<%= produto ? produto.nome : '' %>">
    </div>
    <div class="mb-3">
      <label class="form-label">Descrição</label>
      <textarea name="descricao" class="form-control"><%= produto ? produto.descricao : '' %></textarea>
    </div>
    <div class="mb-3 row">
      <div class="col">
        <label class="form-label">Preço</label>
        <input type="number" step="0.01" name="preco" class="form-control" required value="<%= produto ? produto.preco : '0.00' %>">
      </div>
      <div class="col">
        <label class="form-label">Categoria</label>
        <input type="text" name="categoria" class="form-control" value="<%= produto ? produto.categoria : '' %>">
      </div>
    </div>
    <div class="mb-3 row">
      <div class="col">
        <label class="form-label">Quantidade</label>
        <input type="number" name="quantidade" class="form-control" required value="<%= produto ? produto.quantidade : 0 %>">
      </div>
      <div class="col">
        <label class="form-label">Foto (URL)</label>
        <input type="text" name="foto" class="form-control" value="<%= produto ? produto.foto : '' %>">
      </div>
    </div>
    <div class="mb-3">
      <label class="form-label">Upload de foto (opcional)</label>
      <input type="file" name="fotoFile" class="form-control">
    </div>

    <button class="btn btn-primary">Salvar</button>
    <a class="btn btn-secondary" href="/produtos">Cancelar</a>
  </form>
  <% if (produto) { %>
    <pre class="mt-3">Debug form values: <%= JSON.stringify(produto) %></pre>
  <% } %>
</div>

<%- include('../partials/footer') %>
